{% extends 'core/base.html' %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3 no-print">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb m-0">
        <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Início</a></li>
        <li class="breadcrumb-item"><a href="{% url 'region_list' country %}">{{ country }}</a></li>
        <li class="breadcrumb-item active">{{ region }}</li>
      </ol>
    </nav>
    
    <form class="d-flex" method="GET">
        <input class="form-control form-control-sm me-2" type="search" name="q" placeholder="Buscar vinho..." value="{{ request.GET.q|default:'' }}">
        <button class="btn btn-wine btn-sm" type="submit">Buscar</button>
    </form>
</div>

<style>
    .print-table { width: 100%; border-collapse: collapse; font-size: 12px; }
    .print-table th, .print-table td { border: 1px solid #000; padding: 4px; }
    .print-table th { background-color: #ddd; text-align: center; }
    .row-h { height: 22px; } /* Altura fixa para garantir alinhamento */
    
    @media print {
        @page { size: A4; margin: 10mm; }
        .page-break { page-break-after: always; }
        /* Garante que o cabeçalho se repita se o navegador suportar, 
           mas nossa lógica de 45 linhas faz a quebra manual */
    }
</style>

<div class="card border-0">
    <h4 class="text-center mb-3">{{ country }} - {{ region }}</h4>
    
    <table class="print-table">
        <thead>
            <tr>
                <th style="width: 40%">Vinho</th>
                <th style="width: 10%">Safra</th>
                <th style="width: 8%">RP</th>
                <th style="width: 8%">WS</th>
                <th style="width: 15%">Beber (Ano)</th>
                <th style="width: 10%">Estoque</th>
                {% if is_admin %}
                <th style="width: 9%" class="no-print">Preço</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for wine in page_obj %}
            <tr class="row-h">
                <td>{{ wine.name }}</td>
                <td class="text-center">{{ wine.vintage }}</td>
                <td class="text-center">{{ wine.score_rp|default:"-" }}</td>
                <td class="text-center">{{ wine.score_ws|default:"-" }}</td>
                <td class="text-center">
                    {% if wine.drink_from and wine.drink_to %}
                        {{ wine.drink_from }}-{{ wine.drink_to }}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td class="text-center">
                    {{ wine.quantity }}
                </td>
                {% if is_admin %}
                <td class="text-end no-print">R$ {{ wine.price }}</td>
                {% endif %}
            </tr>
            {% endfor %}

            {% for i in empty_rows %}
            <tr class="row-h">
                <td>&nbsp;</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                {% if is_admin %}<td class="no-print"></td>{% endif %}
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="d-flex justify-content-center mt-3 no-print">
        {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}" class="btn btn-sm btn-outline-secondary me-2">Anterior</a>
        {% endif %}
        
        <span class="align-self-center">Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>
        
        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}" class="btn btn-sm btn-outline-secondary ms-2">Próxima</a>
        {% endif %}
    </div>
</div>
{% endblock %}
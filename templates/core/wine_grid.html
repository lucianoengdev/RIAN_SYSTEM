{% extends 'core/base.html' %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3 no-print">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb m-0">
        <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">In√≠cio</a></li>
        <li class="breadcrumb-item"><a href="{% url 'region_list' country %}">{{ country }}</a></li>
        <li class="breadcrumb-item active">{{ region }}</li>
      </ol>
    </nav>
    
    <form class="d-flex" method="GET">
        <input class="form-control form-control-sm me-2" type="search" name="q" placeholder="Buscar vinho..." value="{{ request.GET.q|default:'' }}">
        <button class="btn btn-wine btn-sm" type="submit">Buscar</button>
    </form>
</div>

<style>
    .print-table { width: 100%; border-collapse: collapse; font-size: 12px; }
    .print-table th, .print-table td { border: 1px solid #000; padding: 4px; }
    .print-table th { background-color: #ddd; text-align: center; }
    .row-h { height: 22px; } /* Altura fixa para garantir alinhamento */
    
    @media print {
        @page { size: A4; margin: 10mm; }
        .page-break { page-break-after: always; }
        .no-print { display: none !important; }
        .table-striped>tbody>tr:nth-of-type(odd)>* { box-shadow: none; }
    }
</style>

<div class="card border-0">
    <h4 class="text-center mb-3">
        {{ country }} - {{ region }}
        {% if target_user != user %}
            <br><small class="text-danger fs-6">(Visualizando adega de: {{ target_user.username }})</small>
        {% endif %}
    </h4>
    
    <table class="print-table">
        <thead>
            <tr>
                <th style="width: 35%">Vinho</th>
                <th style="width: 10%">Safra</th>
                <th style="width: 8%">RP</th>
                <th style="width: 8%">WS</th>
                <th style="width: 15%">Beber (Ano)</th>
                <th style="width: 12%">Estoque</th>
                {% if is_admin %}
                <th style="width: 9%" class="no-print">Pre√ßo</th>
                {% endif %}
                <th style="width: 5%" class="no-print">A√ß√µes</th>
            </tr>
        </thead>
        <tbody>
            {% for wine in page_obj %}
            <tr class="row-h">
                <td>{{ wine.name }}</td>
                <td class="text-center">{{ wine.vintage }}</td>
                <td class="text-center">{{ wine.score_rp|default:"-" }}</td>
                <td class="text-center">{{ wine.score_ws|default:"-" }}</td>
                <td class="text-center">
                    {% if wine.drink_from and wine.drink_to %}
                        {{ wine.drink_from }}-{{ wine.drink_to }}
                    {% else %}
                        -
                    {% endif %}
                </td>
                
                <td class="text-center">
                    <div class="d-flex justify-content-center align-items-center no-print">
                        <form action="{% url 'update_stock' wine.id %}" method="POST" class="d-inline">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="decrease">
                            <button type="submit" class="btn btn-sm btn-outline-danger py-0 px-1" style="font-size: 10px; line-height: 1;">-</button>
                        </form>
                        
                        <span class="mx-2 fw-bold">{{ wine.quantity }}</span>
                        
                        <form action="{% url 'update_stock' wine.id %}" method="POST" class="d-inline">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="increase">
                            <button type="submit" class="btn btn-sm btn-outline-success py-0 px-1" style="font-size: 10px; line-height: 1;">+</button>
                        </form>
                    </div>
                    
                    <span class="d-none d-print-inline">{{ wine.quantity }}</span>
                </td>

                {% if is_admin %}
                <td class="text-end no-print">R$ {{ wine.price }}</td>
                {% endif %}
                
                <td class="text-center no-print">
                    <a href="{% url 'delete_wine' wine.id %}" class="text-danger text-decoration-none" title="Excluir Vinho">
                        üóëÔ∏è
                    </a>
                </td>
            </tr>
            {% endfor %}

            {% for i in empty_rows %}
            <tr class="row-h">
                <td>&nbsp;</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                {% if is_admin %}<td class="no-print"></td>{% endif %}
                <td class="no-print"></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="d-flex justify-content-center mt-3 no-print">
        {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}&q={{ request.GET.q }}" class="btn btn-sm btn-outline-secondary me-2">Anterior</a>
        {% endif %}
        
        <span class="align-self-center">P√°gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>
        
        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}&q={{ request.GET.q }}" class="btn btn-sm btn-outline-secondary ms-2">Pr√≥xima</a>
        {% endif %}
    </div>
</div>
{% endblock %}